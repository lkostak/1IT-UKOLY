<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>T≈ô√≠dn√≠ n√°stƒõnka ‚Äì √∫koly a akce</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="container topbar__inner">
      <div class="brand">
        <div class="brand__logo" aria-hidden="true">1I</div>
        <div class="brand__text">
          <div class="brand__title">T≈ô√≠dn√≠ n√°stƒõnka</div>
          <div class="brand__subtitle">√ökoly ‚Ä¢ Akce ‚Ä¢ Kontakty</div>
        </div>
      </div>

      <nav class="nav" aria-label="Hlavn√≠ navigace">
        <a class="nav__link" href="#domu" data-route="domu">Dom≈Ø</a>
        <a class="nav__link" href="#ukoly" data-route="ukoly">√ökoly</a>
        <a class="nav__link" href="#akce" data-route="akce">Akce</a>
        <a class="nav__link" href="#kontakty" data-route="kontakty">Kontakty</a>
      </nav>

      <div class="admin">
        <label class="toggle" title="Zapne tlaƒç√≠tka pro p≈ôid√°v√°n√≠/upravov√°n√≠">
          <input id="adminToggle" type="checkbox" />
          <span class="toggle__track" aria-hidden="true"></span>
          <span class="toggle__label">Admin</span>
        </label>
      </div>
    </div>
  </header>

  <main class="container" id="app">
    <!-- DOM≈Æ -->
    <section class="page" id="page-domu" data-page="domu">
      <div class="page__head">
        <h1>Dom≈Ø</h1>
        <p class="muted">Rychl√Ω p≈ôehled toho, co nejd≈ô√≠v ho≈ô√≠.</p>
      </div>

      <div class="grid-2">
        <article class="card">
          <div class="card__head">
            <h2>Nejbli≈æ≈°√≠ √∫koly</h2>
            <button class="btn btn--primary admin-only" id="btnAddTaskTop">P≈ôidat √∫kol</button>
          </div>
          <div id="homeTasks" class="stack"></div>
        </article>

        <article class="card">
          <div class="card__head">
            <h2>Nejbli≈æ≈°√≠ akce</h2>
            <button class="btn btn--primary admin-only" id="btnAddEventTop">P≈ôidat akci</button>
          </div>
          <div id="homeEvents" class="stack"></div>
        </article>
      </div>

      <article class="card mt">
        <div class="card__head">
          <h2>Ozn√°men√≠</h2>
        </div>
        <div class="notice">
          <p class="muted" id="announcementHint">
            Tip: v <strong>Admin re≈æimu</strong> m≈Ø≈æe≈° p≈ôid√°vat √∫koly a akce. Data se ukl√°daj√≠ do prohl√≠≈æeƒçe (localStorage).
          </p>
        </div>
      </article>
    </section>

    <!-- √öKOLY -->
    <section class="page" id="page-ukoly" data-page="ukoly" hidden>
      <div class="page__head split">
        <div>
          <h1>√ökoly</h1>
          <p class="muted">Seznam √∫kol≈Ø pro t≈ô√≠du. Filtruj, oznaƒç hotovo, nebo uprav.</p>
        </div>
        <button class="btn btn--primary admin-only" id="btnAddTask">P≈ôidat √∫kol</button>
      </div>

      <div class="card">
        <div class="filters">
          <div class="field">
            <label for="taskFilterSubject">P≈ôedmƒõt</label>
            <select id="taskFilterSubject">
              <option value="">V≈°e</option>
              <option>INF</option>
              <option>MAT</option>
              <option>FYZ</option>
              <option>AJ</option>
              <option>CJ</option>
              <option>EL</option>
              <option>ODB</option>
            </select>
          </div>
          <div class="field">
            <label for="taskFilterStatus">Stav</label>
            <select id="taskFilterStatus">
              <option value="active">Aktivn√≠</option>
              <option value="all">V≈°e</option>
              <option value="done">Hotovo</option>
              <option value="overdue">Pro≈°l√©</option>
            </select>
          </div>
          <div class="field">
            <label for="taskSearch">Hledat</label>
            <input id="taskSearch" type="search" placeholder="nap≈ô. ‚Äöprezentace‚Äò" />
          </div>
        </div>

        <div class="table-wrap">
          <table class="table" aria-describedby="tasksTableHelp">
            <thead>
              <tr>
                <th>P≈ôedmƒõt</th>
                <th>Popis</th>
                <th>Term√≠n</th>
                <th>Stav</th>
                <th class="right">Akce</th>
              </tr>
            </thead>
            <tbody id="tasksTbody"></tbody>
          </table>
        </div>
        <p class="hint" id="tasksTableHelp">Tip: klikni na ‚ÄûHotovo‚Äú a √∫kol se p≈ôesune mezi hotov√©.</p>
      </div>
    </section>

    <!-- AKCE -->
    <section class="page" id="page-akce" data-page="akce" hidden>
      <div class="page__head split">
        <div>
          <h1>Akce</h1>
          <p class="muted">Exkurze, testy, soutƒõ≈æe, t≈ô√≠dn√≠ sch≈Øzky‚Ä¶</p>
        </div>
        <button class="btn btn--primary admin-only" id="btnAddEvent">P≈ôidat akci</button>
      </div>

      <div class="card">
        <div class="filters">
          <div class="field">
            <label for="eventSearch">Hledat</label>
            <input id="eventSearch" type="search" placeholder="nap≈ô. ‚Äöexkurze‚Äò" />
          </div>
          <div class="field">
            <label for="eventFilterWhen">Zobrazit</label>
            <select id="eventFilterWhen">
              <option value="upcoming">Jen nadch√°zej√≠c√≠</option>
              <option value="all">V≈°e</option>
              <option value="past">Jen probƒõhl√©</option>
            </select>
          </div>
        </div>

        <div id="eventsList" class="stack"></div>
      </div>
    </section>

    <!-- KONTAKTY -->
    <section class="page" id="page-kontakty" data-page="kontakty" hidden>
      <div class="page__head">
        <h1>Kontakty</h1>
        <p class="muted">Upravte si podle t≈ô√≠dy/≈°koly (statick√° str√°nka).</p>
      </div>

      <div class="grid-2">
        <article class="card">
          <div class="card__head">
            <h2>T≈ô√≠dn√≠ uƒçitel</h2>
          </div>
          <ul class="list">
            <li><strong>Jm√©no:</strong> ‚Ä¶</li>
            <li><strong>Kabinet:</strong> ‚Ä¶</li>
            <li><strong>Konzultace:</strong> ‚Ä¶</li>
          </ul>
        </article>

        <article class="card">
          <div class="card__head">
            <h2>Odkazy</h2>
          </div>
          <ul class="list">
            <li><a href="#" onclick="return false;">≈†koln√≠ web</a></li>
            <li><a href="#" onclick="return false;">Teams / Classroom</a></li>
            <li><a href="#" onclick="return false;">Sd√≠len√° slo≈æka</a></li>
          </ul>
          <p class="hint">Nahraƒète odkazy skuteƒçn√Ωmi adresami.</p>
        </article>
      </div>

      <article class="card mt">
        <div class="card__head">
          <h2>Pravidla odevzd√°v√°n√≠</h2>
        </div>
        <ul class="list">
          <li>Soubor pojmenuj: <code>prijmeni_jmeno_trida_ukol.ext</code></li>
          <li>Odevzd√°vej vƒças a v domluven√©m form√°tu.</li>
          <li>Dotazy pi≈° do ‚Ä¶</li>
        </ul>
      </article>
    </section>
  </main>

  <!-- MODAL: √öKOL -->
  <dialog class="modal" id="taskModal">
    <form class="modal__panel" method="dialog" id="taskForm">
      <div class="modal__head">
        <h3 id="taskModalTitle">P≈ôidat √∫kol</h3>
        <button class="icon-btn" value="cancel" aria-label="Zav≈ô√≠t">‚úï</button>
      </div>

      <div class="grid-2">
        <div class="field">
          <label for="taskSubject">P≈ôedmƒõt</label>
          <select id="taskSubject" required>
            <option value="" disabled selected>Vyber‚Ä¶</option>
            <option>INF</option>
            <option>MAT</option>
            <option>FYZ</option>
            <option>AJ</option>
            <option>CJ</option>
            <option>EL</option>
            <option>ODB</option>
          </select>
        </div>

        <div class="field">
          <label for="taskDue">Term√≠n</label>
          <input id="taskDue" type="date" required />
        </div>

        <div class="field grid-span-2">
          <label for="taskDesc">Popis</label>
          <input id="taskDesc" type="text" maxlength="140" placeholder="nap≈ô. Vytvo≈ôit str√°nku Dom≈Ø" required />
        </div>

        <div class="field">
          <label for="taskPriority">Priorita</label>
          <select id="taskPriority">
            <option value="low">N√≠zk√°</option>
            <option value="mid" selected>St≈ôedn√≠</option>
            <option value="high">Vysok√°</option>
          </select>
        </div>

        <div class="field">
          <label for="taskLink">Odkaz (voliteln√©)</label>
          <input id="taskLink" type="url" placeholder="https://‚Ä¶" />
        </div>
      </div>

      <div class="modal__foot">
        <button class="btn" value="cancel">Zru≈°it</button>
        <button class="btn btn--primary" id="taskSaveBtn" value="default">Ulo≈æit</button>
      </div>
      <input type="hidden" id="taskId" />
    </form>
  </dialog>

  <!-- MODAL: AKCE -->
  <dialog class="modal" id="eventModal">
    <form class="modal__panel" method="dialog" id="eventForm">
      <div class="modal__head">
        <h3 id="eventModalTitle">P≈ôidat akci</h3>
        <button class="icon-btn" value="cancel" aria-label="Zav≈ô√≠t">‚úï</button>
      </div>

      <div class="grid-2">
        <div class="field grid-span-2">
          <label for="eventName">N√°zev</label>
          <input id="eventName" type="text" maxlength="80" placeholder="nap≈ô. Exkurze ‚Äì firma XYZ" required />
        </div>

        <div class="field">
          <label for="eventDate">Datum</label>
          <input id="eventDate" type="date" required />
        </div>

        <div class="field">
          <label for="eventTime">ƒåas (voliteln√©)</label>
          <input id="eventTime" type="time" />
        </div>

        <div class="field grid-span-2">
          <label for="eventPlace">M√≠sto (voliteln√©)</label>
          <input id="eventPlace" type="text" maxlength="80" placeholder="nap≈ô. Praha / uƒç. 214" />
        </div>

        <div class="field grid-span-2">
          <label for="eventDesc">Popis / instrukce (voliteln√©)</label>
          <textarea id="eventDesc" rows="3" maxlength="300" placeholder="Co vz√≠t s sebou, co je pot≈ôeba udƒõlat‚Ä¶"></textarea>
        </div>
      </div>

      <div class="modal__foot">
        <button class="btn" value="cancel">Zru≈°it</button>
        <button class="btn btn--primary" id="eventSaveBtn" value="default">Ulo≈æit</button>
      </div>
      <input type="hidden" id="eventId" />
    </form>
  </dialog>

  <footer class="footer">
    <div class="container footer__inner">
      <span class="muted">¬© T≈ô√≠dn√≠ n√°stƒõnka ‚Ä¢ ukl√°d√°n√≠ do localStorage</span>
      <button class="linklike" id="btnReset">Vymazat data</button>
    </div>
  </footer>

<script>
(() => {
  // ---------- Helpers ----------
  const $ = (sel, root = document) => root.querySelector(sel);
  const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

  const pad2 = (n) => String(n).padStart(2, "0");

  const todayISO = () => {
    const d = new Date();
    return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
  };

  const toDateKey = (iso) => {
    // iso: YYYY-MM-DD
    const [y,m,d] = iso.split("-").map(Number);
    return new Date(y, m-1, d).getTime();
  };

  const fmtDate = (iso) => {
    const [y,m,d] = iso.split("-").map(Number);
    return `${d}.${m}.${y}`;
  };

  const fmtDateTime = (dateISO, timeHHMM) => {
    if (!timeHHMM) return fmtDate(dateISO);
    return `${fmtDate(dateISO)} ${timeHHMM}`;
  };

  // ---------- Storage ----------
  const KEY = "tridni-nastenka-v1";
  const defaultData = {
    admin: false,
    tasks: [
      // uk√°zky (m≈Ø≈æete smazat)
      { id: String(Date.now() - 300000), subject: "INF", desc: "Zalo≈æit projekt (HTML/CSS) a rozdƒõlit role", due: todayISO(), done: false, priority: "mid", link: "" }
    ],
    events: [
      { id: String(Date.now() - 200000), name: "T≈ô√≠dnick√° hodina", date: todayISO(), time: "", place: "uƒçebna ‚Ä¶", desc: "Organizace projektu, pravidla pr√°ce.", createdAt: Date.now() - 200000 }
    ]
  };

  function load() {
    try {
      const raw = localStorage.getItem(KEY);
      if (!raw) return structuredClone(defaultData);
      const parsed = JSON.parse(raw);
      return {
        admin: !!parsed.admin,
        tasks: Array.isArray(parsed.tasks) ? parsed.tasks : [],
        events: Array.isArray(parsed.events) ? parsed.events : []
      };
    } catch {
      return structuredClone(defaultData);
    }
  }

  function save() {
    localStorage.setItem(KEY, JSON.stringify(state));
  }

  let state = load();

  // ---------- Routing ----------
  const pages = ["domu", "ukoly", "akce", "kontakty"];
  function route() {
    const hash = (location.hash || "#domu").slice(1);
    const page = pages.includes(hash) ? hash : "domu";

    $$(".page").forEach(s => s.hidden = s.dataset.page !== page);
    $$(".nav__link").forEach(a => a.classList.toggle("is-active", a.dataset.route === page));

    // refresh content when entering pages
    if (page === "domu") renderHome();
    if (page === "ukoly") renderTasks();
    if (page === "akce") renderEvents();
  }
  window.addEventListener("hashchange", route);

  // ---------- Admin toggle ----------
  const adminToggle = $("#adminToggle");
  function applyAdminUI() {
    document.documentElement.dataset.admin = state.admin ? "1" : "0";
    adminToggle.checked = !!state.admin;
  }
  adminToggle.addEventListener("change", () => {
    state.admin = adminToggle.checked;
    save();
    applyAdminUI();
  });

  // ---------- Tasks ----------
  const taskModal = $("#taskModal");
  const taskForm = $("#taskForm");
  const taskId = $("#taskId");
  const taskSubject = $("#taskSubject");
  const taskDue = $("#taskDue");
  const taskDesc = $("#taskDesc");
  const taskPriority = $("#taskPriority");
  const taskLink = $("#taskLink");
  const taskModalTitle = $("#taskModalTitle");

  function taskStatus(t) {
    if (t.done) return "done";
    const overdue = toDateKey(t.due) < toDateKey(todayISO());
    return overdue ? "overdue" : "active";
  }

  function openTaskModal(task = null) {
    if (!state.admin) return;
    if (task) {
      taskModalTitle.textContent = "Upravit √∫kol";
      taskId.value = task.id;
      taskSubject.value = task.subject;
      taskDue.value = task.due;
      taskDesc.value = task.desc;
      taskPriority.value = task.priority || "mid";
      taskLink.value = task.link || "";
    } else {
      taskModalTitle.textContent = "P≈ôidat √∫kol";
      taskId.value = "";
      taskSubject.value = "";
      taskDue.value = todayISO();
      taskDesc.value = "";
      taskPriority.value = "mid";
      taskLink.value = "";
    }
    taskModal.showModal();
  }

  function upsertTaskFromForm() {
    const id = taskId.value || String(Date.now());
    const task = {
      id,
      subject: taskSubject.value,
      due: taskDue.value,
      desc: taskDesc.value.trim(),
      done: false,
      priority: taskPriority.value,
      link: (taskLink.value || "").trim()
    };

    const existing = state.tasks.find(t => t.id === id);
    if (existing) {
      // preserve done state
      task.done = !!existing.done;
      Object.assign(existing, task);
    } else {
      state.tasks.push(task);
    }
    save();
  }

  function toggleTaskDone(id) {
    const t = state.tasks.find(x => x.id === id);
    if (!t) return;
    t.done = !t.done;
    save();
    renderTasks();
    renderHome();
  }

  function deleteTask(id) {
    state.tasks = state.tasks.filter(t => t.id !== id);
    save();
    renderTasks();
    renderHome();
  }

  // filters
  const taskFilterSubject = $("#taskFilterSubject");
  const taskFilterStatus = $("#taskFilterStatus");
  const taskSearch = $("#taskSearch");

  [taskFilterSubject, taskFilterStatus, taskSearch].forEach(el => {
    el.addEventListener("input", renderTasks);
  });

  function filteredTasks() {
    const subj = taskFilterSubject.value;
    const status = taskFilterStatus.value;
    const q = taskSearch.value.trim().toLowerCase();

    return state.tasks
      .slice()
      .sort((a,b) => toDateKey(a.due) - toDateKey(b.due))
      .filter(t => !subj || t.subject === subj)
      .filter(t => {
        if (status === "all") return true;
        return taskStatus(t) === status;
      })
      .filter(t => {
        if (!q) return true;
        return `${t.subject} ${t.desc}`.toLowerCase().includes(q);
      });
  }

  function taskBadge(status) {
    if (status === "done") return '<span class="badge badge--ok">Hotovo</span>';
    if (status === "overdue") return '<span class="badge badge--bad">Pro≈°l√©</span>';
    return '<span class="badge badge--mid">Aktivn√≠</span>';
  }

  function priorityDot(p) {
    if (p === "high") return '<span class="dot dot--high" title="Vysok√°"></span>';
    if (p === "low") return '<span class="dot dot--low" title="N√≠zk√°"></span>';
    return '<span class="dot dot--mid" title="St≈ôedn√≠"></span>';
  }

  function renderTasks() {
    const tbody = $("#tasksTbody");
    const rows = filteredTasks().map(t => {
      const status = taskStatus(t);
      const actions = state.admin
        ? `
          <button class="btn btn--small" data-act="done" data-id="${t.id}">${t.done ? "Vr√°tit" : "Hotovo"}</button>
          <button class="btn btn--small" data-act="edit" data-id="${t.id}">Upravit</button>
          <button class="btn btn--small btn--danger" data-act="del" data-id="${t.id}">Smazat</button>
        `
        : `<button class="btn btn--small" data-act="done" data-id="${t.id}">${t.done ? "Vr√°tit" : "Hotovo"}</button>`;

      const link = t.link ? `<a class="tiny-link" href="${t.link}" target="_blank" rel="noopener">odkaz</a>` : "";

      return `
        <tr class="${status === "overdue" ? "row--overdue" : ""} ${t.done ? "row--done" : ""}">
          <td>
            <span class="chip">${t.subject}</span>
          </td>
          <td>
            <div class="row-title">
              ${priorityDot(t.priority)}<span>${escapeHtml(t.desc)}</span> ${link}
            </div>
          </td>
          <td>${fmtDate(t.due)}</td>
          <td>${taskBadge(status)}</td>
          <td class="right">${actions}</td>
        </tr>
      `;
    }).join("");

    tbody.innerHTML = rows || `<tr><td colspan="5" class="muted center">≈Ω√°dn√© √∫koly podle filtru.</td></tr>`;

    // bind actions
    tbody.querySelectorAll("button[data-act]").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.dataset.id;
        const act = btn.dataset.act;
        if (act === "done") return toggleTaskDone(id);
        if (act === "edit") return openTaskModal(state.tasks.find(t => t.id === id));
        if (act === "del") return deleteTask(id);
      });
    });
  }

  // ---------- Events ----------
  const eventModal = $("#eventModal");
  const eventForm = $("#eventForm");
  const eventId = $("#eventId");
  const eventName = $("#eventName");
  const eventDate = $("#eventDate");
  const eventTime = $("#eventTime");
  const eventPlace = $("#eventPlace");
  const eventDesc = $("#eventDesc");
  const eventModalTitle = $("#eventModalTitle");

  const eventSearch = $("#eventSearch");
  const eventFilterWhen = $("#eventFilterWhen");
  [eventSearch, eventFilterWhen].forEach(el => el.addEventListener("input", renderEvents));

  function openEventModal(ev = null) {
    if (!state.admin) return;
    if (ev) {
      eventModalTitle.textContent = "Upravit akci";
      eventId.value = ev.id;
      eventName.value = ev.name;
      eventDate.value = ev.date;
      eventTime.value = ev.time || "";
      eventPlace.value = ev.place || "";
      eventDesc.value = ev.desc || "";
    } else {
      eventModalTitle.textContent = "P≈ôidat akci";
      eventId.value = "";
      eventName.value = "";
      eventDate.value = todayISO();
      eventTime.value = "";
      eventPlace.value = "";
      eventDesc.value = "";
    }
    eventModal.showModal();
  }

  function upsertEventFromForm() {
    const id = eventId.value || String(Date.now());
    const ev = {
      id,
      name: eventName.value.trim(),
      date: eventDate.value,
      time: (eventTime.value || "").trim(),
      place: (eventPlace.value || "").trim(),
      desc: (eventDesc.value || "").trim(),
      createdAt: Date.now()
    };

    const existing = state.events.find(e => e.id === id);
    if (existing) {
      Object.assign(existing, ev);
    } else {
      state.events.push(ev);
    }
    save();
  }

  function deleteEvent(id) {
    state.events = state.events.filter(e => e.id !== id);
    save();
    renderEvents();
    renderHome();
  }

  function isPastEvent(ev) {
    // If has time, compare datetime; else compare date only
    const base = new Date(`${ev.date}T${ev.time || "00:00"}`);
    const now = new Date();
    return base.getTime() < now.getTime();
  }

  function filteredEvents() {
    const q = eventSearch.value.trim().toLowerCase();
    const when = eventFilterWhen.value;

    return state.events
      .slice()
      .sort((a,b) => {
        const ta = new Date(`${a.date}T${a.time || "00:00"}`).getTime();
        const tb = new Date(`${b.date}T${b.time || "00:00"}`).getTime();
        return ta - tb;
      })
      .filter(ev => {
        const past = isPastEvent(ev);
        if (when === "all") return true;
        if (when === "past") return past;
        return !past; // upcoming
      })
      .filter(ev => {
        if (!q) return true;
        return `${ev.name} ${ev.place} ${ev.desc}`.toLowerCase().includes(q);
      });
  }

  function renderEvents() {
    const list = $("#eventsList");
    const items = filteredEvents().map(ev => {
      const past = isPastEvent(ev);
      const actions = state.admin
        ? `
          <div class="actions">
            <button class="btn btn--small" data-act="edit" data-id="${ev.id}">Upravit</button>
            <button class="btn btn--small btn--danger" data-act="del" data-id="${ev.id}">Smazat</button>
          </div>
        `
        : "";

      const meta = [
        fmtDateTime(ev.date, ev.time),
        ev.place ? escapeHtml(ev.place) : null
      ].filter(Boolean).join(" ‚Ä¢ ");

      const desc = ev.desc ? `<p class="muted">${escapeHtml(ev.desc)}</p>` : "";

      return `
        <article class="item ${past ? "item--past" : ""}">
          <div class="item__main">
            <div class="item__title">${escapeHtml(ev.name)}</div>
            <div class="item__meta">${meta}</div>
            ${desc}
          </div>
          ${actions}
        </article>
      `;
    }).join("");

    list.innerHTML = items || `<div class="muted center">≈Ω√°dn√© akce podle filtru.</div>`;

    list.querySelectorAll("button[data-act]").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.dataset.id;
        const act = btn.dataset.act;
        if (act === "edit") return openEventModal(state.events.find(e => e.id === id));
        if (act === "del") return deleteEvent(id);
      });
    });
  }

  // ---------- Home ----------
  function renderHome() {
    const homeTasks = $("#homeTasks");
    const homeEvents = $("#homeEvents");

    // tasks: show next 3 active (including overdue)
    const tasks = state.tasks
      .slice()
      .filter(t => !t.done)
      .sort((a,b) => toDateKey(a.due) - toDateKey(b.due))
      .slice(0, 3);

    homeTasks.innerHTML = tasks.map(t => {
      const status = taskStatus(t);
      const due = fmtDate(t.due);
      return `
        <div class="mini">
          <div class="mini__left">
            <span class="chip">${t.subject}</span>
            <div class="mini__title">${escapeHtml(t.desc)}</div>
            <div class="mini__meta">${due} ‚Ä¢ ${status === "overdue" ? "pro≈°l√©" : "term√≠n"}</div>
          </div>
          <div class="mini__right">
            ${taskBadge(status)}
          </div>
        </div>
      `;
    }).join("") || `<div class="muted">≈Ω√°dn√© aktivn√≠ √∫koly üéâ</div>`;

    // events: show next 2 upcoming
    const events = state.events
      .slice()
      .filter(e => !isPastEvent(e))
      .sort((a,b) => new Date(`${a.date}T${a.time || "00:00"}`) - new Date(`${b.date}T${b.time || "00:00"}`))
      .slice(0, 2);

    homeEvents.innerHTML = events.map(ev => {
      const meta = fmtDateTime(ev.date, ev.time) + (ev.place ? ` ‚Ä¢ ${escapeHtml(ev.place)}` : "");
      return `
        <div class="mini">
          <div class="mini__left">
            <div class="mini__title">${escapeHtml(ev.name)}</div>
            <div class="mini__meta">${meta}</div>
          </div>
          <div class="mini__right">
            <span class="badge badge--mid">Nadch√°z√≠</span>
          </div>
        </div>
      `;
    }).join("") || `<div class="muted">≈Ω√°dn√© nadch√°zej√≠c√≠ akce.</div>`;
  }

  // ---------- Buttons ----------
  $("#btnAddTask").addEventListener("click", () => openTaskModal());
  $("#btnAddTaskTop").addEventListener("click", () => openTaskModal());
  $("#btnAddEvent").addEventListener("click", () => openEventModal());
  $("#btnAddEventTop").addEventListener("click", () => openEventModal());

  taskForm.addEventListener("submit", (e) => {
    e.preventDefault();
    upsertTaskFromForm();
    taskModal.close();
    renderTasks();
    renderHome();
  });

  eventForm.addEventListener("submit", (e) => {
    e.preventDefault();
    upsertEventFromForm();
    eventModal.close();
    renderEvents();
    renderHome();
  });

  $("#btnReset").addEventListener("click", () => {
    if (!confirm("Opravdu smazat v≈°echna ulo≈æen√° data (√∫koly/akce) v tomto prohl√≠≈æeƒçi?")) return;
    localStorage.removeItem(KEY);
    state = load();
    applyAdminUI();
    renderHome();
    renderTasks();
    renderEvents();
    location.hash = "#domu";
  });

  // ---------- XSS-safe escape for user input ----------
  function escapeHtml(str) {
    return String(str)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  // ---------- Init ----------
  applyAdminUI();
  route();
})();
</script>

</body>
</html>
